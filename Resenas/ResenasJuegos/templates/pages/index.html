{% extends 'layouts/general_layout.html' %}

{% block content_layout %}

<h1 class="text-2xl font-bold text-center my-6">
  <a href="{% url 'post_create' %}"
    class="flex items-center justify-center gap-2 text-white hover:text-[#f0f1f4] group">
    <span class="group-hover:text-[#f0f1f4] transition-colors">
      {% include 'partials/home_icons/add_icon.html' %}
    </span>
    <span class="relative pb-1">
      POST
      <span
        class="absolute left-0 bottom-0 w-0 h-[2px] bg-[#f0f1f4] group-hover:w-full transition-all duration-300 ease-out"></span>
    </span>
  </a>
</h1>

{% for categoria, posts in posts_por_categoria.items %}
<section class="mb-10 relative group">
  <h2 class="text-xl font-semibold mb-4">{{ categoria }} ({{ posts.count }})</h2>

  {% if posts %}
  <div class="relative">
    <!-- Contenedor scroll (scrollbar oculta) -->
    <div id="scroll-{{ forloop.counter }}" class="flex gap-4 overflow-x-auto scroll-smooth pb-0 hide-scrollbar">
      {% for post in posts %}
      {% include 'components/cards/flip_card.html' with post=post %}
      {% endfor %}
    </div>

    <!-- Flecha izquierda -->
    <button type="button" onclick="scrollRowLeft('scroll-{{ forloop.counter }}')" class="absolute left-0 top-0 h-full px-3 bg-[rgba(11,7,26,0.6)] text-[var(--color-text-light)] z-10
         flex items-center justify-center opacity-80 md:group-hover:opacity-100
         transition-all duration-300 hover:bg-[rgba(11,7,26,0.8)] pointer-events-auto">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>

    <!-- Flecha derecha -->
    <button type="button" onclick="scrollRowRight('scroll-{{ forloop.counter }}')" class="absolute right-0 top-0 h-full px-3 bg-[rgba(11,7,26,0.6)] text-[var(--color-text-light)] z-10
         flex items-center justify-center opacity-80 md:group-hover:opacity-100
         transition-all duration-300 hover:bg-[rgba(11,7,26,0.8)] pointer-events-auto">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>

  </div>
  {% else %}
  <p class="text-gray-500">No hay posts para esta categoría.</p>
  {% endif %}
</section>
{% endfor %}

{% endblock content_layout %}

{% block scripts %}
<script>
  // Calcula el paso: ancho de la primera card + gap del contenedor (salta "una card")
  function stepFor(container) {
    if (!container) return 300;
    const styles = getComputedStyle(container);
    const gap = parseFloat(styles.gap) || 16;
    // :scope asegura que sea hijo directo (una card)
    const firstChild = container.querySelector(':scope > *');
    const cardWidth = firstChild ? firstChild.getBoundingClientRect().width : 284;
    return Math.ceil(cardWidth + gap);
  }

  function scrollRowLeft(id) {
    const c = document.getElementById(id);
    if (!c) return;
    const step = stepFor(c);
    // usamos scrollBy relativo para evitar cálculos con límites manuales
    c.scrollBy({ left: -step, behavior: 'smooth' });
  }

  function scrollRowRight(id) {
    const c = document.getElementById(id);
    if (!c) return;
    const step = stepFor(c);
    c.scrollBy({ left: step, behavior: 'smooth' });
  }
</script>
{% endblock scripts %}