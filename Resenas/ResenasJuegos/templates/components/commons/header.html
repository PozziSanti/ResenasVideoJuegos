{% load static %}

<header
    class="fixed top-0 left-0 right-0 bg-darker-morado p-1 shadow-md flex justify-between items-center w-full z-50 h-16">

    <!-- Logo y menú -->
    <div class="flex items-center space-x-3">
        <button id="menu-toggle"
            class="ml-2 text-text-light hover:text-accent-blue transition-colors duration-200 focus:outline-none w-12 h-12 flex items-center justify-center">
            <img src="{% static 'assets/header_icons/menu_hamburguesa.png' %}" alt="Menu" class="w-8 h-8 invert">
        </button>

        <a href="{% url 'home' %}" class="flex items-center space-x-2">
            <img src="{% static 'assets/header_icons/hit_or_quit_logo.png' %}" alt="Hit or Quit Logo" class="h-12">
            <span class="text-white text-2xl font-bold hidden sm:block leading-5">Hit or<br>Quit</span>
        </a>
    </div>

    <!-- Contenedor central para buscador y filtros -->
    <div class="hidden sm:flex items-center justify-center flex-1 px-4">
        <!-- Buscador -->
        <form method="get" action="{% url 'post_search' %}" class="relative w-full max-w-md mr-4">
            <input type="text" name="q" id="search-input" placeholder="Buscar..."
                class="w-full bg-light-morado text-text-light px-4 py-2 rounded-full focus:outline-none focus:ring-2 focus:ring-accent-blue placeholder-text-medium text-sm sm:text-base"
                autocomplete="off" value="{{ request.GET.q|default:'' }}">

            <div id="suggestions"
                class="absolute mt-1 w-full bg-light-morado rounded-lg shadow-lg text-text-light hidden z-50 border border-accent-blue max-h-60 overflow-auto">
            </div>

            <button type="submit"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-text-medium hover:text-text-light transition-colors duration-200">
                <img src="{% static 'assets/header_icons/buscador.png' %}" alt="Buscar"
                    class="w-5 h-5 sm:w-6 sm:h-6 filter invert opacity-50">
            </button>
        </form>

        <!-- Filtros desplegable -->
        <div class="relative ml-4">
            <button id="filters-toggle"
                class="bg-light-morado hover:bg-accent-blue text-light px-3 py-2 rounded-full transition flex items-center">
                <img src="{% static 'assets/header_icons/filter_icon.png' %}" alt="Filtros" class="w-5 h-5 invert mr-1">
                <span class="text-sm hidden md:inline">Filtros</span>
            </button>

            <div id="filters-dropdown"
                class="hidden absolute right-0 mt-2 w-64 bg-darker-morado rounded-lg shadow-lg z-50 border border-accent-blue p-3">
                <h3 class="text-light font-semibold mb-2 text-sm">Filtrar Post</h3>
                <div class="space-y-2">
                    <!-- Más Recientes -->
                    <form method="get" action="{% url 'post_by_date' %}" class="w-full">
                        <input type="hidden" name="date" value="{% now 'Y-m-d' %}">
                        <button type="submit"
                            class="w-full text-left bg-light-morado hover:bg-accent-blue text-light px-3 py-2 rounded-md transition text-sm">
                            Más Recientes
                        </button>
                    </form>

                    <!-- Más Antiguos -->
                    <form method="get" action="{% url 'post_by_date' %}" class="w-full">
                        <input type="hidden" name="date" value="1970-01-01">
                        <button type="submit"
                            class="w-full text-left bg-light-morado hover:bg-accent-blue text-light px-3 py-2 rounded-md transition text-sm">
                            Más Antiguos
                        </button>
                    </form>

                    <!-- Mejor Puntuados -->
                    <form method="get" action="{% url 'post_by_star' %}" class="w-full">
                        <input type="hidden" name="score" value="1">
                        <button type="submit"
                            class="w-full text-left bg-light-morado hover:bg-accent-blue text-light px-3 py-2 rounded-md transition text-sm">
                            Mejor Puntuados
                        </button>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <!-- Usuario / Login -->
    <div class="flex items-center ml-auto space-x-4 mr-4">
        {% if user.is_authenticated %}
        <a href="{% url 'user_profile' %}"
            class="flex items-center px-4 justify-center text-white text-2xl transition-all duration-200 hover:drop-shadow-[0_0_10px_rgba(255,255,255,0.8)]">
            <span class="ml-2 px-4 text-1xl">
                {% if user.alias %}
                {{ user.alias }}
                {% else %}
                {{ user.username }}
                {% endif %}
            </span>

            {% if user.avatar %}
            <span id="user-avatar-container" class="pl-6 pr-10">
                <img src="{{ user.avatar.url }}" alt="Avatar de {{ user.alias|default:user.username }}"
                    class="w-12 h-12 rounded-full object-cover" onerror="replaceWithIcon(this);">
            </span>
            {% else %}
            <i class="fa fa-user"></i>
            {% endif %}
        </a>

        {% else %}
        <div class="flex space-x-4">
            <a href="{% url 'signin' %}?next={{ request.path }}" class="block">
                <button class="relative w-40 h-12 bg-darker-morado cursor-pointer overflow-hidden">
                    <span
                        class="absolute left-1/2 -translate-x-1/2 top-1 flex items-center justify-center w-[7em] h-[2em] bg-accent-blue border border-white rounded text-gray-100 text-lg font-semibold shadow-[0_0.2em_0.1em_0.019em_white] transition-all duration-200 hover:translate-y-2 hover:shadow-none">
                        Iniciar Sesión
                    </span>
                </button>
            </a>
            <a href="{% url 'signup' %}?next={{ request.path }}" class="block">
                <button class="relative w-40 h-12 bg-darker-morado cursor-pointer overflow-hidden">
                    <span
                        class="absolute left-1/2 -translate-x-1/2 top-1 flex items-center justify-center w-[7em] h-[2em] bg-accent-blue border border-white rounded text-gray-100 text-lg font-semibold shadow-[0_0.2em_0.1em_0.019em_white] transition-all duration-200 hover:translate-y-2 hover:shadow-none">
                        Registrarse
                    </span>
                </button>
            </a>
        </div>
        {% endif %}
    </div>
</header>

{% block scripts %}

<script src="{% static 'js/header_logic.js' %}"></script>

{% endblock scripts %}