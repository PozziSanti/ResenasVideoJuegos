<div class="bg-[#0B071A] p-6 rounded-xl border border-[#241D44] mb-8 w-full">
    <h2 class="text-2xl font-bold mb-6 text-[#f0f1f4]">Comentarios</h2>

    {% for comment in comments %}
    <div class="mb-4 p-4 bg-[#130C2A] rounded-lg border border-[#241D44]">
        {% if comment.id == editing_comment_id %}
        <form method="post" action="{% url 'comment_update' comment.id %}" class="space-y-4">
            {% csrf_token %}
            <!-- Campo de contenido -->
            <div class="form-group">
                <textarea name="content"
                    class="w-full bg-[#130C2A] text-[#f0f1f4] p-4 rounded-lg border border-[#241D44] focus:outline-none focus:ring-2 focus:ring-[#4F46E5] focus:border-transparent"
                    rows="4" placeholder="Escribí tu reseña acá...">{{ edit_comment_form.content.value }}</textarea>
            </div>

            <!-- Campo de puntuación -->
            <div class="flex items-center gap-2 my-3">
                <span class="text-[#f0f1f4] font-medium">Puntuación:</span>
                <div class="w-20">
                    {{ edit_comment_form.score }}
                </div>
            </div>

            <!-- Botones -->
            <div class="flex space-x-2">
                <button type="submit"
                    class="bg-[#4F46E5] hover:bg-[#4338CA] text-white px-4 py-2 rounded-lg transition-colors">
                    Guardar
                </button>
                <a href="{% url 'post_detail' post.slug %}"
                    class="bg-[#241D44] hover:bg-[#1E1838] text-[#f0f1f4] px-4 py-2 rounded-lg transition-colors">
                    Cancelar
                </a>
            </div>
        </form>
        {% else %}
        <div class="flex justify-between items-center mb-2">
            <span class="font-bold text-[#f0f1f4]">{{ comment.user.username }}</span>
            <span class="text-yellow-500">{{ comment.score }} ⭐</span>
        </div>
        <p class="text-[#f0f1f4]">{{ comment.content }}</p>

        {% if user == comment.user or user == post.author %}
        <div class="mt-2">
            <!-- Botón Editar -->
            <a href="?edit_comment_id={{ comment.id }}" class="text-yellow-500 hover:underline mr-4">Editar</a>

            <!-- Botón Eliminar -->
            <button type="button" data-comment-id="{{ comment.id }}"
                class="text-red-500 hover:underline delete-comment-btn">
                Eliminar
            </button>
        </div>
        {% endif %}
        {% endif %}
    </div>
    {% empty %}
    <p class="text-[#f0f1f4] opacity-80 pb-6 border-b border-[#241D44]">No hay comentarios aún.</p>
    {% endfor %}

    {% if user.is_authenticated %}
    <h3 class="text-xl font-semibold mb-4 mt-6 text-[#f0f1f4]">Dejá tu reseña</h3>
    <form method="post">
        {% csrf_token %}
        <div class="space-y-4">
            <!-- Campo de contenido -->
            <div class="form-group">
                <textarea name="content"
                    class="w-full bg-[#130C2A] text-[#f0f1f4] p-4 rounded-lg border border-[#241D44] focus:outline-none focus:ring-2 focus:ring-[#4F46E5] focus:border-transparent"
                    rows="4"
                    placeholder="Escribí tu reseña acá...">{% if edit_comment %}{{ edit_comment.content }}{% endif %}</textarea>
            </div>

            <!-- Sistema de puntuación por estrellas -->
            <div class="form-group">
                <label class="block mb-2 text-[#f0f1f4] font-medium">Puntuación</label>
                <div class="flex items-center space-x-1 star-rating">
                    {% for i in "12345"|make_list %}
                    <label class="cursor-pointer">
                        <input type="radio" name="score" value="{{ i }}" class="hidden peer star-{{ i }}">
                        <span
                            class="text-3xl text-gray-400 hover:text-yellow-500 transition-colors duration-200">★</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
        </div>
        <button type="submit"
            class="mt-4 bg-[#4F46E5] hover:bg-[#4338CA] text-white px-4 py-2 rounded-lg transition-colors">
            {% if edit_comment %}Actualizar{% else %}Enviar{% endif %}
        </button>
    </form>
    {% else %}
    <p class="text-[#f0f1f4] opacity-80 mt-6">Iniciá sesión para dejar tu comentario y puntuación.</p>
    {% endif %}
</div>

{% include 'post/post_delete_comment.html' %}

{% block scripts %}
<script>
    // Sistema de puntuación estrellas
    document.querySelectorAll('.star-rating input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', function () {
            const selectedValue = parseInt(this.value);
            const stars = this.closest('.star-rating').querySelectorAll('span');
            stars.forEach((star, index) => {
                star.classList.toggle('text-yellow-500', index < selectedValue);
                star.classList.toggle('text-gray-400', index >= selectedValue);
            });
        });
    });

    // Abrir modal de eliminación de comentario
    document.querySelectorAll('.delete-comment-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const commentId = btn.dataset.commentId;
            document.getElementById('deleteCommentId').value = commentId;
            document.getElementById('deleteCommentModal').classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
        });
    });

    function closeDeleteCommentModal() {
        document.getElementById('deleteCommentModal').classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
    }

    document.getElementById('deleteCommentModal')?.addEventListener('click', function (e) {
        if (e.target === this) closeDeleteCommentModal();
    });
</script>
{% endblock scripts %}