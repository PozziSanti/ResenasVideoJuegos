{% extends 'layouts/general_layout.html' %}


{% block content_layout %}
<div class="max-w-3xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8 text-center text-[#f0f1f4]">
        Actualización de Post
    </h1>

    <form method="post" enctype="multipart/form-data"
        class="space-y-6 bg-[#0B071A] p-6 rounded-xl border border-[#241D44]">
        {% csrf_token %}

        <!-- Campos principales -->
        <div class="space-y-6">

            <!-- Título -->
            <div class="form-group">
                <label class="block mb-2 text-[#f0f1f4] font-medium">Título</label>
                <input type="text" name="{{ form.title.name }}" id="{{ form.title.id_for_label }}"
                    value="{{ form.title.value|default:'' }}"
                    class="w-full px-4 py-3 bg-[#241D44] border-2 border-[#4F46E5] rounded-lg text-[#f0f1f4] focus:ring-2 focus:ring-[#622bbf] focus:outline-none transition-all"
                    placeholder="Escribe un título">
                {% if form.title.errors %}
                <ul class="mt-1 text-sm text-[#EF4444]">
                    {% for error in form.title.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <!-- Descripción -->
            <div class="form-group">
                <label class="block mb-2 text-[#f0f1f4] font-medium">Descripción</label>
                <textarea name="{{ form.content.name }}" id="{{ form.content.id_for_label }}"
                    class="w-full px-4 py-3 bg-[#241D44] border-2 border-[#4F46E5] rounded-lg text-[#f0f1f4] focus:ring-2 focus:ring-[#622bbf] focus:outline-none transition-all"
                    rows="6" placeholder="Escribe una descripción...">{{ form.content.value|default:'' }}</textarea>
                {% if form.content.errors %}
                <ul class="mt-1 text-sm text-[#EF4444]">
                    {% for error in form.content.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <!-- Categoría -->
            <!-- <div class="form-group">
                <label class="block mb-2 text-[#f0f1f4] font-medium">Categoría</label>
                <select name="category" id="id_category"
                        class="w-full px-4 py-3 bg-[#241D44] border-2 border-[#4F46E5] rounded-lg text-[#f0f1f4] focus:ring-2 focus:ring-[#622bbf] focus:outline-none transition-all">
                    <option value="">Selecciona una categoría</option>
                    {% for category in form.category.field.queryset %}
                        <option value="{{ category.id }}" {% if category.id in selected_category_ids %}selected{% endif %}>
                            {{ category.title }}
                        </option>
                    {% endfor %}
                </select>
                {% if form.category.errors %}
                    <ul class="mt-1 text-sm text-[#EF4444]">
                        {% for error in form.category.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div> -->

            <!-- Imagenes -->
            <div>
                <h3>Imagenes Cargadas</h3>
                {% for active_img in form.active_images %}
                <p><Img src="{{ active_img.image.url }}" alt="Portada del post {{ active_img.id }}"></Img><input
                        type="checkbox" name="keep_image_{{ active_img.id }}" id="keep_image_{{ active_img.id }}"
                        checked> <label for="keep_image_{{ active_img.id }}"></label></p>
                

                {% endfor %}


            </div>


            <!-- Botón de enviar -->
            <button type="submit"
                class="w-full py-3 px-6 bg-[#622bbf] hover:bg-[#4F46E5] text-white font-bold rounded-lg transition-colors duration-300 mt-6 shadow-lg hover:shadow-[#4F46E5]/50">
                Actualizar Post
            </button>
        </div>
    </form>
</div>

{% endblock content_layout %}

{% block scripts %}
<!-- Script para añadir imágenes dinámicamente -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const addButton = document.getElementById('add-image-btn');
        const formsetContainer = document.getElementById('images-formset');
        const totalForms = document.getElementById('id_images-TOTAL_FORMS');
        let formCount = parseInt(totalForms.value);

        addButton.addEventListener('click', function () {
            const emptyFormTemplate = document.getElementById('empty-form').innerHTML;
            const formHtml = emptyFormTemplate
                .replace(/__prefix__/g, formCount)
                .replace(/__NUM__/g, formCount + 1);

            formsetContainer.insertAdjacentHTML('beforeend', formHtml);
            formCount++;
            totalForms.value = formCount;
        });
    });
</script>
{% endblock scripts %}